@model IEnumerable<Facturacion.Models.Detalle_Factura>

@{
    ViewData["Title"] = "Index Detalle";
  
}



<h1>Index</h1>
 
<p>
    
</p><form asp-action="Create" method="post">
        <span class="alert-danger" id="error"> @TempData["error"]</span>
    <table> <thead><tr> <th>Producto</th> <th> Cantidad</th><th>Precio unitario</th> </thead> <tbody><tr><td> <select id="producto"name="prod" asp-items="ViewBag.ID_PROUCTO"> </select></td><td><input type="number" id="ca" name="quan"  /> </td><td id="prc"> <input type="number" name="prec" readonly="readonly" /></td>  <td><input id="agg" type="submit" value="agregar" /></td></tr></tbody> </table> 
</form>
    <script>
     
        
        const producto = document.querySelector('#producto');

        document.addEventListener('DOMContentLoaded', () => {
          
            $.getJSON("/Detalle_factura/GetData", function (data) {

                for (var i = 0; i < data.length; i++) {
                    if (data[i].name == producto.value) {
                        document.querySelector('#prc').innerHTML = ` <input type="number" value="${data[i].count}" name="prec" readonly="readonly" /> `;
                    }

                }

                setTimeout(function () { document.querySelector('#error').innerHTML = ''; }, 3000);








            }
            )
        })
    producto.addEventListener('click', e => {
        
        $(document).ready(function () {
            $.getJSON("/Detalle_factura/GetData", function (data) {

                for (var i = 0; i < data.length; i++) {
                    if (data[i].name == e.target.value) {
                        document.querySelector('#prc').innerHTML = ` <input type="number" value="${data[i].count}" name="prec" readonly="readonly" /> `;
}
                       
                }










            }
            )
        }
        )
    })














    </script>
<table class="table">
    <thead>
        <tr>
            
            <th>
                @Html.DisplayNameFor(model => model.producto)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.cantidad)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Precio_Unitario)
            </th>
            <th>Subtotal</th>
            <th></th>


        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                
                <td>
                    @Html.DisplayFor(modelItem => item.producto.NOMBRE)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.cantidad)
                </td>
                <td>
                   $ @Html.DisplayFor(modelItem => item.Precio_Unitario)
                </td>
                <td>
                  $ @(item.Precio_Unitario*item.cantidad)
                </td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Numero_Factura" asp-route-id2="@item.ID_PROUCTO">
                        <input type="button" class="btn btn-secondary" value="Editar" />

                    </a>
                    <a asp-action="Delete" asp-route-id="@item.Numero_Factura" asp-route-id2="@item.ID_PROUCTO">
                        <input type="button" class="btn btn-danger" value="Eliminar" />

                    </a>
                </td>
            </tr>
        }
        <tr> <td colspan="3"> </td> <td> Total : $@TempData["total"] </td></tr>
    </tbody>
</table>

<div >
    <a asp-action="Index" asp-controller="Facturas">
        <input type="button" class="btn btn-warning" value="Regresar" />
    </a>
</div>